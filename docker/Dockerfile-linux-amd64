# Ubuntu Fitzhi container
# docker pull adoptopenjdk/openjdk11:x86_64-ubuntu-jre-11.0.15_10
FROM eclipse-temurin:11.0.15_10-jre
LABEL Frederic VIDAL (frederic.vidal@fitzhi.com)

RUN apt update; \
	apt-get -y install git; \
	apt-get -y install nginx; \
	mkdir -p spoq

# URL where the Sonar server is installed
ARG urlSonarServer

# First authentification credential : user/password.
# User required to be identified by Sonar. Default is "admin"
ARG user
# Password required to be identified in Sonar.
# This property is mandatory if the connection is made with the pair user/password
ARG password

# Second authentification credential : token login.
# Login token generated by the Sonar security module.
ARG login

COPY spoq spoq

RUN	cd fitzhi; \
	curl --insecure https://spoq.fitzhi.com/release/back-fitzhi.zip --output deploy.zip; \
	tar xvf deploy.zip; \
	cp ./deploy/docker/default /etc/nginx/sites-enabled/default; \
	cp ./deploy/docker/start-fitzhi.sh ./deploy/backend-fitzhi/start-fitzhi.sh; \
	cp ./deploy/docker/sonar-servers.json ./deploy/data/referential/sonar-servers.json; \
	cd /; \
	echo "export DOCKER_FITZHI_BUILDTIME=#buildingTime" >> ~/.bashrc

WORKDIR /fitzhi/deploy/backend-fitzhi

CMD ./start-fitzhi.sh 
EXPOSE 80
