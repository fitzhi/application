# Ubuntu Fitzhi container
# docker pull adoptopenjdk/openjdk11:x86_64-ubuntu-jre-11.0.15_10
FROM eclipse-temurin:11.0.15_10-jre
LABEL Frederic VIDAL (frederic.vidal@fitzhi.com)

ENV DEBIAN_FRONTEND noninteractive
RUN apt-get update; \
    apt-get -y install git nginx

# URL where the Sonar server is installed
ARG urlSonarServer

# First authentification credential : user/password.
# User required to be identified by Sonar. Default is "admin"
ARG user
# Password required to be identified in Sonar.
# This property is mandatory if the connection is made with the pair user/password
ARG password

# Second authentification credential : token login.
# Login token generated by the Sonar security module.
ARG login

COPY spoq spoq

COPY fitzhi fitzhi

RUN	cd /; \
#	cp ./deploy/docker/default /etc/nginx/sites-enabled/default; \
	cp fitzhi/deploy/docker/start-fitzhi.sh fitzhi/deploy/back-fitzhi/start-fitzhi.sh; \
	cp fitzhi/deploy/docker/sonar-servers.json fitzhi/deploy/data/referential/sonar-servers.json; \
	echo "export DOCKER_FITZHI_BUILDTIME=#buildingTime" >> ~/.bashrc

WORKDIR /fitzhi/deploy/back-fitzhi

CMD ./start-fitzhi.sh 
EXPOSE 80
